!function(e){if("function"==typeof define&&define.amd)define(["jquery"],e);else if("object"==typeof exports){var n=require("jquery");module.exports=e(n)}else e(window.jQuery||window.Zepto||window.$)}(function(f){"use strict";f.fn.serializeJSON=function(e){var r,s,t,n,a,i,u,l,o,p,c,d;return r=f.serializeJSON,s=this,t=r.setupOpts(e),n=s.serializeArray(),r.readCheckboxUncheckedValues(n,t,s),a={},f.each(n,function(e,n){i=n.name,u=n.value,o=r.extractTypeAndNameWithNoType(i),p=o.nameWithNoType,(c=o.type)||(c=r.attrFromInputWithName(s,i,"data-value-type")),r.validateType(i,c,t),"skip"!==c&&(d=r.splitInputNameIntoKeysArray(p),l=r.parseValue(u,i,c,t),!l&&r.shouldSkipFalsy(s,i,p,c,t)||r.deepSet(a,d,l,t))}),a},f.serializeJSON={defaultOptions:{checkboxUncheckedValue:void 0,parseNumbers:!1,parseBooleans:!1,parseNulls:!1,parseAll:!1,parseWithFunction:null,skipFalsyValuesForTypes:[],skipFalsyValuesForFields:[],customTypes:{},defaultTypes:{string:function(e){return String(e)},number:function(e){return Number(e)},boolean:function(e){return-1===["false","null","undefined","","0"].indexOf(e)},null:function(e){return-1===["false","null","undefined","","0"].indexOf(e)?e:null},array:function(e){return JSON.parse(e)},object:function(e){return JSON.parse(e)},auto:function(e){return f.serializeJSON.parseValue(e,null,null,{parseNumbers:!0,parseBooleans:!0,parseNulls:!0})},skip:null},useIntKeysAsArrayIndex:!1},setupOpts:function(n){var e,r,s,t,a,i;for(e in i=f.serializeJSON,null==n&&(n={}),s=i.defaultOptions||{},r=["checkboxUncheckedValue","parseNumbers","parseBooleans","parseNulls","parseAll","parseWithFunction","skipFalsyValuesForTypes","skipFalsyValuesForFields","customTypes","defaultTypes","useIntKeysAsArrayIndex"],n)if(-1===r.indexOf(e))throw new Error("serializeJSON ERROR: invalid option '"+e+"'. Please use one of "+r.join(", "));return a=(t=function(e){return!1!==n[e]&&""!==n[e]&&(n[e]||s[e])})("parseAll"),{checkboxUncheckedValue:t("checkboxUncheckedValue"),parseNumbers:a||t("parseNumbers"),parseBooleans:a||t("parseBooleans"),parseNulls:a||t("parseNulls"),parseWithFunction:t("parseWithFunction"),skipFalsyValuesForTypes:t("skipFalsyValuesForTypes"),skipFalsyValuesForFields:t("skipFalsyValuesForFields"),typeFunctions:f.extend({},t("defaultTypes"),t("customTypes")),useIntKeysAsArrayIndex:t("useIntKeysAsArrayIndex")}},parseValue:function(e,n,r,s){var t,a;return t=f.serializeJSON,a=e,s.typeFunctions&&r&&s.typeFunctions[r]?a=s.typeFunctions[r](e):s.parseNumbers&&t.isNumeric(e)?a=Number(e):!s.parseBooleans||"true"!==e&&"false"!==e?s.parseNulls&&"null"==e&&(a=null):a="true"===e,s.parseWithFunction&&!r&&(a=s.parseWithFunction(a,n)),a},isObject:function(e){return e===Object(e)},isUndefined:function(e){return void 0===e},isValidArrayIndex:function(e){return/^[0-9]+$/.test(String(e))},isNumeric:function(e){return 0<=e-parseFloat(e)},optionKeys:function(e){if(Object.keys)return Object.keys(e);var n,r=[];for(n in e)r.push(n);return r},readCheckboxUncheckedValues:function(r,s,e){var n,t,a;null==s&&(s={}),f.serializeJSON,n="input[type=checkbox][name]:not(:checked):not([disabled])",e.find(n).add(e.filter(n)).each(function(e,n){if(t=f(n),null==(a=t.attr("data-unchecked-value"))&&(a=s.checkboxUncheckedValue),null!=a){if(n.name&&-1!==n.name.indexOf("[]["))throw new Error("serializeJSON ERROR: checkbox unchecked values are not supported on nested arrays of objects like '"+n.name+"'. See https://github.com/marioizquierdo/jquery.serializeJSON/issues/67");r.push({name:n.name,value:a})}})},extractTypeAndNameWithNoType:function(e){var n;return(n=e.match(/(.*):([^:]+)$/))?{nameWithNoType:n[1],type:n[2]}:{nameWithNoType:e,type:null}},shouldSkipFalsy:function(e,n,r,s,t){var a=f.serializeJSON.attrFromInputWithName(e,n,"data-skip-falsy");if(null!=a)return"false"!==a;var i=t.skipFalsyValuesForFields;if(i&&(-1!==i.indexOf(r)||-1!==i.indexOf(n)))return!0;var u=t.skipFalsyValuesForTypes;return null==s&&(s="string"),!(!u||-1===u.indexOf(s))},attrFromInputWithName:function(e,n,r){var s;return s='[name="'+n.replace(/(:|\.|\[|\]|\s)/g,"\\$1")+'"]',e.find(s).add(e.filter(s)).attr(r)},validateType:function(e,n,r){var s,t;if(s=(t=f.serializeJSON).optionKeys(r?r.typeFunctions:t.defaultOptions.defaultTypes),n&&-1===s.indexOf(n))throw new Error("serializeJSON ERROR: Invalid type "+n+" found in input name '"+e+"', please use one of "+s.join(", "));return!0},splitInputNameIntoKeysArray:function(e){var n;return f.serializeJSON,n=e.split("["),""===(n=f.map(n,function(e){return e.replace(/\]/g,"")}))[0]&&n.shift(),n},deepSet:function(e,n,r,s){var t,a,i,u,l,o;if(null==s&&(s={}),(o=f.serializeJSON).isUndefined(e))throw new Error("ArgumentError: param 'o' expected to be an object or array, found undefined");if(!n||0===n.length)throw new Error("ArgumentError: param 'keys' expected to be an array with least one element");t=n[0],1===n.length?""===t?e.push(r):e[t]=r:(a=n[1],""===t&&(l=e[u=e.length-1],t=o.isObject(l)&&(o.isUndefined(l[a])||2<n.length)?u:u+1),""===a?!o.isUndefined(e[t])&&f.isArray(e[t])||(e[t]=[]):s.useIntKeysAsArrayIndex&&o.isValidArrayIndex(a)?!o.isUndefined(e[t])&&f.isArray(e[t])||(e[t]=[]):!o.isUndefined(e[t])&&o.isObject(e[t])||(e[t]={}),i=n.slice(1),o.deepSet(e[t],i,r,s))}}});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpxdWVyeS5zZXJpYWxpemVqc29uLmpzIl0sIm5hbWVzIjpbImZhY3RvcnkiLCJkZWZpbmUiLCJhbWQiLCJleHBvcnRzIiwialF1ZXJ5IiwicmVxdWlyZSIsIm1vZHVsZSIsIndpbmRvdyIsIlplcHRvIiwiJCIsImZuIiwic2VyaWFsaXplSlNPTiIsIm9wdGlvbnMiLCJmIiwiJGZvcm0iLCJvcHRzIiwiZm9ybUFzQXJyYXkiLCJzZXJpYWxpemVkT2JqZWN0IiwibmFtZSIsInZhbHVlIiwicGFyc2VkVmFsdWUiLCJfb2JqIiwibmFtZVdpdGhOb1R5cGUiLCJ0eXBlIiwia2V5cyIsInRoaXMiLCJzZXR1cE9wdHMiLCJzZXJpYWxpemVBcnJheSIsInJlYWRDaGVja2JveFVuY2hlY2tlZFZhbHVlcyIsImVhY2giLCJpIiwib2JqIiwiZXh0cmFjdFR5cGVBbmROYW1lV2l0aE5vVHlwZSIsImF0dHJGcm9tSW5wdXRXaXRoTmFtZSIsInZhbGlkYXRlVHlwZSIsInNwbGl0SW5wdXROYW1lSW50b0tleXNBcnJheSIsInBhcnNlVmFsdWUiLCJzaG91bGRTa2lwRmFsc3kiLCJkZWVwU2V0IiwiZGVmYXVsdE9wdGlvbnMiLCJjaGVja2JveFVuY2hlY2tlZFZhbHVlIiwidW5kZWZpbmVkIiwicGFyc2VOdW1iZXJzIiwicGFyc2VCb29sZWFucyIsInBhcnNlTnVsbHMiLCJwYXJzZUFsbCIsInBhcnNlV2l0aEZ1bmN0aW9uIiwic2tpcEZhbHN5VmFsdWVzRm9yVHlwZXMiLCJza2lwRmFsc3lWYWx1ZXNGb3JGaWVsZHMiLCJjdXN0b21UeXBlcyIsImRlZmF1bHRUeXBlcyIsInN0cmluZyIsInN0ciIsIlN0cmluZyIsIm51bWJlciIsIk51bWJlciIsImJvb2xlYW4iLCJpbmRleE9mIiwibnVsbCIsImFycmF5IiwiSlNPTiIsInBhcnNlIiwib2JqZWN0IiwiYXV0byIsInNraXAiLCJ1c2VJbnRLZXlzQXNBcnJheUluZGV4Iiwib3B0IiwidmFsaWRPcHRzIiwib3B0V2l0aERlZmF1bHQiLCJFcnJvciIsImpvaW4iLCJrZXkiLCJ0eXBlRnVuY3Rpb25zIiwiZXh0ZW5kIiwidmFsU3RyIiwiaW5wdXROYW1lIiwicGFyc2VkVmFsIiwiaXNOdW1lcmljIiwiaXNPYmplY3QiLCJPYmplY3QiLCJpc1VuZGVmaW5lZCIsImlzVmFsaWRBcnJheUluZGV4IiwidmFsIiwidGVzdCIsInBhcnNlRmxvYXQiLCJvcHRpb25LZXlzIiwicHVzaCIsInNlbGVjdG9yIiwiJGVsIiwidW5jaGVja2VkVmFsdWUiLCJmaW5kIiwiYWRkIiwiZmlsdGVyIiwiZWwiLCJhdHRyIiwibWF0Y2giLCJza2lwRnJvbURhdGFBdHRyIiwib3B0Rm9yRmllbGRzIiwib3B0Rm9yVHlwZXMiLCJhdHRyTmFtZSIsInJlcGxhY2UiLCJ2YWxpZFR5cGVzIiwic3BsaXQiLCJtYXAiLCJzaGlmdCIsIm8iLCJuZXh0S2V5IiwidGFpbCIsImxhc3RJZHgiLCJsYXN0VmFsIiwibGVuZ3RoIiwiaXNBcnJheSIsInNsaWNlIl0sIm1hcHBpbmdzIjoiQ0FTQSxTQUFBQSxHQUNBLEdBQUEsbUJBQUFDLFFBQUFBLE9BQUFDLElBQ0FELE9BQUEsQ0FBQSxVQUFBRCxRQUNBLEdBQUEsaUJBQUFHLFFBQUEsQ0FDQSxJQUFBQyxFQUFBQyxRQUFBLFVBQ0FDLE9BQUFILFFBQUFILEVBQUFJLFFBRUFKLEVBQUFPLE9BQUFILFFBQUFHLE9BQUFDLE9BQUFELE9BQUFFLEdBUEEsQ0FVQSxTQUFBQSxHQUNBLGFBR0FBLEVBQUFDLEdBQUFDLGNBQUEsU0FBQUMsR0FDQSxJQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQThCQSxPQTdCQVgsRUFBQUosRUFBQUUsY0FDQUcsRUFBQVcsS0FDQVYsRUFBQUYsRUFBQWEsVUFBQWQsR0FHQUksRUFBQUYsRUFBQWEsaUJBQ0FkLEVBQUFlLDRCQUFBWixFQUFBRCxFQUFBRCxHQUdBRyxFQUFBLEdBQ0FSLEVBQUFvQixLQUFBYixFQUFBLFNBQUFjLEVBQUFDLEdBQ0FiLEVBQUFhLEVBQUFiLEtBQ0FDLEVBQUFZLEVBQUFaLE1BQ0FFLEVBQUFSLEVBQUFtQiw2QkFBQWQsR0FDQUksRUFBQUQsRUFBQUMsZ0JBQ0FDLEVBQUFGLEVBQUFFLFFBQ0FBLEVBQUFWLEVBQUFvQixzQkFBQW5CLEVBQUFJLEVBQUEsb0JBQ0FMLEVBQUFxQixhQUFBaEIsRUFBQUssRUFBQVIsR0FFQSxTQUFBUSxJQUNBQyxFQUFBWCxFQUFBc0IsNEJBQUFiLEdBQ0FGLEVBQUFQLEVBQUF1QixXQUFBakIsRUFBQUQsRUFBQUssRUFBQVIsSUFFQUssR0FBQVAsRUFBQXdCLGdCQUFBdkIsRUFBQUksRUFBQUksRUFBQUMsRUFBQVIsSUFFQUYsRUFBQXlCLFFBQUFyQixFQUFBTyxFQUFBSixFQUFBTCxNQUlBRSxHQUtBUixFQUFBRSxjQUFBLENBRUE0QixlQUFBLENBQ0FDLDRCQUFBQyxFQUVBQyxjQUFBLEVBQ0FDLGVBQUEsRUFDQUMsWUFBQSxFQUNBQyxVQUFBLEVBQ0FDLGtCQUFBLEtBRUFDLHdCQUFBLEdBQ0FDLHlCQUFBLEdBRUFDLFlBQUEsR0FDQUMsYUFBQSxDQUNBQyxPQUFBLFNBQUFDLEdBQUEsT0FBQUMsT0FBQUQsSUFDQUUsT0FBQSxTQUFBRixHQUFBLE9BQUFHLE9BQUFILElBQ0FJLFFBQUEsU0FBQUosR0FBQSxPQUFBLElBQUEsQ0FBQSxRQUFBLE9BQUEsWUFBQSxHQUFBLEtBQUFLLFFBQUFMLElBQ0FNLEtBQUEsU0FBQU4sR0FBQSxPQUFBLElBQUEsQ0FBQSxRQUFBLE9BQUEsWUFBQSxHQUFBLEtBQUFLLFFBQUFMLEdBQUFBLEVBQUEsTUFDQU8sTUFBQSxTQUFBUCxHQUFBLE9BQUFRLEtBQUFDLE1BQUFULElBQ0FVLE9BQUEsU0FBQVYsR0FBQSxPQUFBUSxLQUFBQyxNQUFBVCxJQUNBVyxLQUFBLFNBQUFYLEdBQUEsT0FBQTNDLEVBQUFFLGNBQUF5QixXQUFBZ0IsRUFBQSxLQUFBLEtBQUEsQ0FBQVYsY0FBQSxFQUFBQyxlQUFBLEVBQUFDLFlBQUEsS0FDQW9CLEtBQUEsTUFHQUMsd0JBQUEsR0FJQXZDLFVBQUEsU0FBQWQsR0FDQSxJQUFBc0QsRUFBQUMsRUFBQTVCLEVBQUE2QixFQUFBdkIsRUFBQWhDLEVBUUEsSUFBQXFELEtBUEFyRCxFQUFBSixFQUFBRSxjQUVBLE1BQUFDLElBQUFBLEVBQUEsSUFDQTJCLEVBQUExQixFQUFBMEIsZ0JBQUEsR0FHQTRCLEVBQUEsQ0FBQSx5QkFBQSxlQUFBLGdCQUFBLGFBQUEsV0FBQSxvQkFBQSwwQkFBQSwyQkFBQSxjQUFBLGVBQUEsMEJBQ0F2RCxFQUNBLElBQUEsSUFBQXVELEVBQUFWLFFBQUFTLEdBQ0EsTUFBQSxJQUFBRyxNQUFBLHdDQUFBSCxFQUFBLHdCQUFBQyxFQUFBRyxLQUFBLE9BU0EsT0FEQXpCLEdBSEF1QixFQUFBLFNBQUFHLEdBQUEsT0FBQSxJQUFBM0QsRUFBQTJELElBQUEsS0FBQTNELEVBQUEyRCxLQUFBM0QsRUFBQTJELElBQUFoQyxFQUFBZ0MsTUFHQSxZQUNBLENBQ0EvQix1QkFBQTRCLEVBQUEsMEJBRUExQixhQUFBRyxHQUFBdUIsRUFBQSxnQkFDQXpCLGNBQUFFLEdBQUF1QixFQUFBLGlCQUNBeEIsV0FBQUMsR0FBQXVCLEVBQUEsY0FDQXRCLGtCQUFBc0IsRUFBQSxxQkFFQXJCLHdCQUFBcUIsRUFBQSwyQkFDQXBCLHlCQUFBb0IsRUFBQSw0QkFDQUksY0FBQS9ELEVBQUFnRSxPQUFBLEdBQUFMLEVBQUEsZ0JBQUFBLEVBQUEsZ0JBRUFILHVCQUFBRyxFQUFBLDRCQUtBaEMsV0FBQSxTQUFBc0MsRUFBQUMsRUFBQXBELEVBQUFSLEdBQ0EsSUFBQUYsRUFBQStELEVBaUJBLE9BaEJBL0QsRUFBQUosRUFBQUUsY0FDQWlFLEVBQUFGLEVBRUEzRCxFQUFBeUQsZUFBQWpELEdBQUFSLEVBQUF5RCxjQUFBakQsR0FDQXFELEVBQUE3RCxFQUFBeUQsY0FBQWpELEdBQUFtRCxHQUNBM0QsRUFBQTJCLGNBQUE3QixFQUFBZ0UsVUFBQUgsR0FDQUUsRUFBQXJCLE9BQUFtQixJQUNBM0QsRUFBQTRCLGVBQUEsU0FBQStCLEdBQUEsVUFBQUEsRUFFQTNELEVBQUE2QixZQUFBLFFBQUE4QixJQUNBRSxFQUFBLE1BRkFBLEVBQUEsU0FBQUYsRUFJQTNELEVBQUErQixvQkFBQXZCLElBQ0FxRCxFQUFBN0QsRUFBQStCLGtCQUFBOEIsRUFBQUQsSUFHQUMsR0FHQUUsU0FBQSxTQUFBL0MsR0FBQSxPQUFBQSxJQUFBZ0QsT0FBQWhELElBQ0FpRCxZQUFBLFNBQUFqRCxHQUFBLFlBQUEsSUFBQUEsR0FDQWtELGtCQUFBLFNBQUFDLEdBQUEsTUFBQSxXQUFBQyxLQUFBOUIsT0FBQTZCLEtBQ0FMLFVBQUEsU0FBQTlDLEdBQUEsT0FBQSxHQUFBQSxFQUFBcUQsV0FBQXJELElBRUFzRCxXQUFBLFNBQUF0RCxHQUFBLEdBQUFnRCxPQUFBdkQsS0FBQSxPQUFBdUQsT0FBQXZELEtBQUFPLEdBQUEsSUFBQXdDLEVBQUEvQyxFQUFBLEdBQUEsSUFBQStDLEtBQUF4QyxFQUFBUCxFQUFBOEQsS0FBQWYsR0FBQSxPQUFBL0MsR0FPQUksNEJBQUEsU0FBQVosRUFBQUQsRUFBQUQsR0FDQSxJQUFBeUUsRUFBQUMsRUFBQUMsRUFDQSxNQUFBMUUsSUFBQUEsRUFBQSxJQUNBTixFQUFBRSxjQUVBNEUsRUFBQSwyREFDQXpFLEVBQUE0RSxLQUFBSCxHQUFBSSxJQUFBN0UsRUFBQThFLE9BQUFMLElBQ0ExRCxLQUFBLFNBQUFDLEVBQUErRCxHQVNBLEdBUEFMLEVBQUEvRSxFQUFBb0YsR0FFQSxPQURBSixFQUFBRCxFQUFBTSxLQUFBLDJCQUVBTCxFQUFBMUUsRUFBQXlCLHdCQUlBLE1BQUFpRCxFQUFBLENBQ0EsR0FBQUksRUFBQTNFLE9BQUEsSUFBQTJFLEVBQUEzRSxLQUFBdUMsUUFBQSxPQUNBLE1BQUEsSUFBQVksTUFBQSxzR0FBQXdCLEVBQUEzRSxLQUFBLDJFQUVBRixFQUFBc0UsS0FBQSxDQUFBcEUsS0FBQTJFLEVBQUEzRSxLQUFBQyxNQUFBc0UsUUFVQXpELDZCQUFBLFNBQUFkLEdBQ0EsSUFBQTZFLEVBQ0EsT0FBQUEsRUFBQTdFLEVBQUE2RSxNQUFBLGtCQUNBLENBQUF6RSxlQUFBeUUsRUFBQSxHQUFBeEUsS0FBQXdFLEVBQUEsSUFFQSxDQUFBekUsZUFBQUosRUFBQUssS0FBQSxPQU9BYyxnQkFBQSxTQUFBdkIsRUFBQUksRUFBQUksRUFBQUMsRUFBQVIsR0FDQSxJQUVBaUYsRUFGQXZGLEVBQUFFLGNBRUFzQixzQkFBQW5CLEVBQUFJLEVBQUEsbUJBQ0EsR0FBQSxNQUFBOEUsRUFDQSxNQUFBLFVBQUFBLEVBR0EsSUFBQUMsRUFBQWxGLEVBQUFpQyx5QkFDQSxHQUFBaUQsS0FBQSxJQUFBQSxFQUFBeEMsUUFBQW5DLEtBQUEsSUFBQTJFLEVBQUF4QyxRQUFBdkMsSUFDQSxPQUFBLEVBR0EsSUFBQWdGLEVBQUFuRixFQUFBZ0Msd0JBRUEsT0FEQSxNQUFBeEIsSUFBQUEsRUFBQSxhQUNBMkUsSUFBQSxJQUFBQSxFQUFBekMsUUFBQWxDLEtBU0FVLHNCQUFBLFNBQUFuQixFQUFBSSxFQUFBaUYsR0FDQSxJQUFBWixFQUlBLE9BRkFBLEVBQUEsVUFEQXJFLEVBQUFrRixRQUFBLG1CQUFBLFFBQ0EsS0FDQXRGLEVBQUE0RSxLQUFBSCxHQUFBSSxJQUFBN0UsRUFBQThFLE9BQUFMLElBQ0FPLEtBQUFLLElBSUFqRSxhQUFBLFNBQUFoQixFQUFBSyxFQUFBUixHQUNBLElBQUFzRixFQUFBeEYsRUFHQSxHQURBd0YsR0FEQXhGLEVBQUFKLEVBQUFFLGVBQ0EwRSxXQUFBdEUsRUFBQUEsRUFBQXlELGNBQUEzRCxFQUFBMEIsZUFBQVcsY0FDQTNCLElBQUEsSUFBQThFLEVBQUE1QyxRQUFBbEMsR0FHQSxNQUFBLElBQUE4QyxNQUFBLHFDQUFBOUMsRUFBQSx5QkFBQUwsRUFBQSx3QkFBQW1GLEVBQUEvQixLQUFBLE9BRkEsT0FBQSxHQWVBbkMsNEJBQUEsU0FBQWIsR0FDQSxJQUFBRSxFQUtBLE9BSkFmLEVBQUFFLGNBQ0FhLEVBQUFGLEVBQUFnRixNQUFBLEtBRUEsTUFEQTlFLEVBQUFmLEVBQUE4RixJQUFBL0UsRUFBQSxTQUFBK0MsR0FBQSxPQUFBQSxFQUFBNkIsUUFBQSxNQUFBLE9BQ0EsSUFBQTVFLEVBQUFnRixRQUNBaEYsR0FvQkFjLFFBQUEsU0FBQW1FLEVBQUFqRixFQUFBTCxFQUFBSixHQUNBLElBQUF3RCxFQUFBbUMsRUFBQUMsRUFBQUMsRUFBQUMsRUFBQWhHLEVBR0EsR0FGQSxNQUFBRSxJQUFBQSxFQUFBLEtBQ0FGLEVBQUFKLEVBQUFFLGVBQ0FxRSxZQUFBeUIsR0FBQSxNQUFBLElBQUFwQyxNQUFBLCtFQUNBLElBQUE3QyxHQUFBLElBQUFBLEVBQUFzRixPQUFBLE1BQUEsSUFBQXpDLE1BQUEsOEVBRUFFLEVBQUEvQyxFQUFBLEdBR0EsSUFBQUEsRUFBQXNGLE9BQ0EsS0FBQXZDLEVBQ0FrQyxFQUFBbkIsS0FBQW5FLEdBRUFzRixFQUFBbEMsR0FBQXBELEdBS0F1RixFQUFBbEYsRUFBQSxHQUtBLEtBQUErQyxJQUVBc0MsRUFBQUosRUFEQUcsRUFBQUgsRUFBQUssT0FBQSxHQUdBdkMsRUFEQTFELEVBQUFpRSxTQUFBK0IsS0FBQWhHLEVBQUFtRSxZQUFBNkIsRUFBQUgsS0FBQSxFQUFBbEYsRUFBQXNGLFFBQ0FGLEVBRUFBLEVBQUEsR0FLQSxLQUFBRixHQUNBN0YsRUFBQW1FLFlBQUF5QixFQUFBbEMsS0FBQTlELEVBQUFzRyxRQUFBTixFQUFBbEMsTUFDQWtDLEVBQUFsQyxHQUFBLElBR0F4RCxFQUFBa0Qsd0JBQUFwRCxFQUFBb0Usa0JBQUF5QixJQUNBN0YsRUFBQW1FLFlBQUF5QixFQUFBbEMsS0FBQTlELEVBQUFzRyxRQUFBTixFQUFBbEMsTUFDQWtDLEVBQUFsQyxHQUFBLEtBR0ExRCxFQUFBbUUsWUFBQXlCLEVBQUFsQyxLQUFBMUQsRUFBQWlFLFNBQUEyQixFQUFBbEMsTUFDQWtDLEVBQUFsQyxHQUFBLElBTUFvQyxFQUFBbkYsRUFBQXdGLE1BQUEsR0FDQW5HLEVBQUF5QixRQUFBbUUsRUFBQWxDLEdBQUFvQyxFQUFBeEYsRUFBQUoiLCJmaWxlIjoianF1ZXJ5LXNlcmlhbGl6ZWpzb24ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gIFNlcmlhbGl6ZUpTT04galF1ZXJ5IHBsdWdpbi5cbiAgaHR0cHM6Ly9naXRodWIuY29tL21hcmlvaXpxdWllcmRvL2pxdWVyeS5zZXJpYWxpemVKU09OXG4gIHZlcnNpb24gMi44LjEgKERlYywgMjAxNilcblxuICBDb3B5cmlnaHQgKGMpIDIwMTIsIDIwMTcgTWFyaW8gSXpxdWllcmRvXG4gIER1YWwgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCAoaHR0cDovL3d3dy5vcGVuc291cmNlLm9yZy9saWNlbnNlcy9taXQtbGljZW5zZS5waHApXG4gIGFuZCBHUEwgKGh0dHA6Ly93d3cub3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvZ3BsLWxpY2Vuc2UucGhwKSBsaWNlbnNlcy5cbiovXG4oZnVuY3Rpb24gKGZhY3RvcnkpIHtcbiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkgeyAvLyBBTUQuIFJlZ2lzdGVyIGFzIGFuIGFub255bW91cyBtb2R1bGUuXG4gICAgZGVmaW5lKFsnanF1ZXJ5J10sIGZhY3RvcnkpO1xuICB9IGVsc2UgaWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JykgeyAvLyBOb2RlL0NvbW1vbkpTXG4gICAgdmFyIGpRdWVyeSA9IHJlcXVpcmUoJ2pxdWVyeScpO1xuICAgIG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeShqUXVlcnkpO1xuICB9IGVsc2UgeyAvLyBCcm93c2VyIGdsb2JhbHMgKHplcHRvIHN1cHBvcnRlZClcbiAgICBmYWN0b3J5KHdpbmRvdy5qUXVlcnkgfHwgd2luZG93LlplcHRvIHx8IHdpbmRvdy4kKTsgLy8gWmVwdG8gc3VwcG9ydGVkIG9uIGJyb3dzZXJzIGFzIHdlbGxcbiAgfVxuXG59KGZ1bmN0aW9uICgkKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIC8vIGpRdWVyeSgnZm9ybScpLnNlcmlhbGl6ZUpTT04oKVxuICAkLmZuLnNlcmlhbGl6ZUpTT04gPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgIHZhciBmLCAkZm9ybSwgb3B0cywgZm9ybUFzQXJyYXksIHNlcmlhbGl6ZWRPYmplY3QsIG5hbWUsIHZhbHVlLCBwYXJzZWRWYWx1ZSwgX29iaiwgbmFtZVdpdGhOb1R5cGUsIHR5cGUsIGtleXMsIHNraXBGYWxzeTtcbiAgICBmID0gJC5zZXJpYWxpemVKU09OO1xuICAgICRmb3JtID0gdGhpczsgLy8gTk9URTogdGhlIHNldCBvZiBtYXRjaGVkIGVsZW1lbnRzIGlzIG1vc3QgbGlrZWx5IGEgZm9ybSwgYnV0IGl0IGNvdWxkIGFsc28gYmUgYSBncm91cCBvZiBpbnB1dHNcbiAgICBvcHRzID0gZi5zZXR1cE9wdHMob3B0aW9ucyk7IC8vIGNhbGN1bGF0ZSB2YWx1ZXMgZm9yIG9wdGlvbnMge3BhcnNlTnVtYmVycywgcGFyc2VCb29sZW5zLCBwYXJzZU51bGxzLCAuLi59IHdpdGggZGVmYXVsdHNcblxuICAgIC8vIFVzZSBuYXRpdmUgYHNlcmlhbGl6ZUFycmF5YCBmdW5jdGlvbiB0byBnZXQgYW4gYXJyYXkgb2Yge25hbWUsIHZhbHVlfSBvYmplY3RzLlxuICAgIGZvcm1Bc0FycmF5ID0gJGZvcm0uc2VyaWFsaXplQXJyYXkoKTtcbiAgICBmLnJlYWRDaGVja2JveFVuY2hlY2tlZFZhbHVlcyhmb3JtQXNBcnJheSwgb3B0cywgJGZvcm0pOyAvLyBhZGQgb2JqZWN0cyB0byB0aGUgYXJyYXkgZnJvbSB1bmNoZWNrZWQgY2hlY2tib3hlcyBpZiBuZWVkZWRcblxuICAgIC8vIENvbnZlcnQgdGhlIGZvcm1Bc0FycmF5IGludG8gYSBzZXJpYWxpemVkT2JqZWN0IHdpdGggbmVzdGVkIGtleXNcbiAgICBzZXJpYWxpemVkT2JqZWN0ID0ge307XG4gICAgJC5lYWNoKGZvcm1Bc0FycmF5LCBmdW5jdGlvbiAoaSwgb2JqKSB7XG4gICAgICBuYW1lICA9IG9iai5uYW1lOyAvLyBvcmlnaW5hbCBpbnB1dCBuYW1lXG4gICAgICB2YWx1ZSA9IG9iai52YWx1ZTsgLy8gaW5wdXQgdmFsdWVcbiAgICAgIF9vYmogPSBmLmV4dHJhY3RUeXBlQW5kTmFtZVdpdGhOb1R5cGUobmFtZSk7XG4gICAgICBuYW1lV2l0aE5vVHlwZSA9IF9vYmoubmFtZVdpdGhOb1R5cGU7IC8vIGlucHV0IG5hbWUgd2l0aCBubyB0eXBlIChpLmUuIFwiZm9vOnN0cmluZ1wiID0+IFwiZm9vXCIpXG4gICAgICB0eXBlID0gX29iai50eXBlOyAvLyB0eXBlIGRlZmluZWQgZnJvbSB0aGUgaW5wdXQgbmFtZSBpbiA6dHlwZSBjb2xvbiBub3RhdGlvblxuICAgICAgaWYgKCF0eXBlKSB0eXBlID0gZi5hdHRyRnJvbUlucHV0V2l0aE5hbWUoJGZvcm0sIG5hbWUsICdkYXRhLXZhbHVlLXR5cGUnKTtcbiAgICAgIGYudmFsaWRhdGVUeXBlKG5hbWUsIHR5cGUsIG9wdHMpOyAvLyBtYWtlIHN1cmUgdGhhdCB0aGUgdHlwZSBpcyBvbmUgb2YgdGhlIHZhbGlkIHR5cGVzIGlmIGRlZmluZWRcblxuICAgICAgaWYgKHR5cGUgIT09ICdza2lwJykgeyAvLyBpZ25vcmUgaW5wdXRzIHdpdGggdHlwZSAnc2tpcCdcbiAgICAgICAga2V5cyA9IGYuc3BsaXRJbnB1dE5hbWVJbnRvS2V5c0FycmF5KG5hbWVXaXRoTm9UeXBlKTtcbiAgICAgICAgcGFyc2VkVmFsdWUgPSBmLnBhcnNlVmFsdWUodmFsdWUsIG5hbWUsIHR5cGUsIG9wdHMpOyAvLyBjb252ZXJ0IHRvIHN0cmluZywgbnVtYmVyLCBib29sZWFuLCBudWxsIG9yIGN1c3RvbVR5cGVcblxuICAgICAgICBza2lwRmFsc3kgPSAhcGFyc2VkVmFsdWUgJiYgZi5zaG91bGRTa2lwRmFsc3koJGZvcm0sIG5hbWUsIG5hbWVXaXRoTm9UeXBlLCB0eXBlLCBvcHRzKTsgLy8gaWdub3JlIGZhbHN5IGlucHV0cyBpZiBzcGVjaWZpZWRcbiAgICAgICAgaWYgKCFza2lwRmFsc3kpIHtcbiAgICAgICAgICBmLmRlZXBTZXQoc2VyaWFsaXplZE9iamVjdCwga2V5cywgcGFyc2VkVmFsdWUsIG9wdHMpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHNlcmlhbGl6ZWRPYmplY3Q7XG4gIH07XG5cbiAgLy8gVXNlICQuc2VyaWFsaXplSlNPTiBhcyBuYW1lc3BhY2UgZm9yIHRoZSBhdXhpbGlhciBmdW5jdGlvbnNcbiAgLy8gYW5kIHRvIGRlZmluZSBkZWZhdWx0c1xuICAkLnNlcmlhbGl6ZUpTT04gPSB7XG5cbiAgICBkZWZhdWx0T3B0aW9uczoge1xuICAgICAgY2hlY2tib3hVbmNoZWNrZWRWYWx1ZTogdW5kZWZpbmVkLCAvLyB0byBpbmNsdWRlIHRoYXQgdmFsdWUgZm9yIHVuY2hlY2tlZCBjaGVja2JveGVzIChpbnN0ZWFkIG9mIGlnbm9yaW5nIHRoZW0pXG5cbiAgICAgIHBhcnNlTnVtYmVyczogZmFsc2UsIC8vIGNvbnZlcnQgdmFsdWVzIGxpa2UgXCIxXCIsIFwiLTIuMzNcIiB0byAxLCAtMi4zM1xuICAgICAgcGFyc2VCb29sZWFuczogZmFsc2UsIC8vIGNvbnZlcnQgXCJ0cnVlXCIsIFwiZmFsc2VcIiB0byB0cnVlLCBmYWxzZVxuICAgICAgcGFyc2VOdWxsczogZmFsc2UsIC8vIGNvbnZlcnQgXCJudWxsXCIgdG8gbnVsbFxuICAgICAgcGFyc2VBbGw6IGZhbHNlLCAvLyBhbGwgb2YgdGhlIGFib3ZlXG4gICAgICBwYXJzZVdpdGhGdW5jdGlvbjogbnVsbCwgLy8gdG8gdXNlIGN1c3RvbSBwYXJzZXIsIGEgZnVuY3Rpb24gbGlrZTogZnVuY3Rpb24odmFsKXsgcmV0dXJuIHBhcnNlZF92YWw7IH1cblxuICAgICAgc2tpcEZhbHN5VmFsdWVzRm9yVHlwZXM6IFtdLCAvLyBza2lwIHNlcmlhbGl6YXRpb24gb2YgZmFsc3kgdmFsdWVzIGZvciBsaXN0ZWQgdmFsdWUgdHlwZXNcbiAgICAgIHNraXBGYWxzeVZhbHVlc0ZvckZpZWxkczogW10sIC8vIHNraXAgc2VyaWFsaXphdGlvbiBvZiBmYWxzeSB2YWx1ZXMgZm9yIGxpc3RlZCBmaWVsZCBuYW1lc1xuXG4gICAgICBjdXN0b21UeXBlczoge30sIC8vIG92ZXJyaWRlIGRlZmF1bHRUeXBlc1xuICAgICAgZGVmYXVsdFR5cGVzOiB7XG4gICAgICAgIFwic3RyaW5nXCI6ICBmdW5jdGlvbihzdHIpIHsgcmV0dXJuIFN0cmluZyhzdHIpOyB9LFxuICAgICAgICBcIm51bWJlclwiOiAgZnVuY3Rpb24oc3RyKSB7IHJldHVybiBOdW1iZXIoc3RyKTsgfSxcbiAgICAgICAgXCJib29sZWFuXCI6IGZ1bmN0aW9uKHN0cikgeyB2YXIgZmFsc2VzID0gW1wiZmFsc2VcIiwgXCJudWxsXCIsIFwidW5kZWZpbmVkXCIsIFwiXCIsIFwiMFwiXTsgcmV0dXJuIGZhbHNlcy5pbmRleE9mKHN0cikgPT09IC0xOyB9LFxuICAgICAgICBcIm51bGxcIjogICAgZnVuY3Rpb24oc3RyKSB7IHZhciBmYWxzZXMgPSBbXCJmYWxzZVwiLCBcIm51bGxcIiwgXCJ1bmRlZmluZWRcIiwgXCJcIiwgXCIwXCJdOyByZXR1cm4gZmFsc2VzLmluZGV4T2Yoc3RyKSA9PT0gLTEgPyBzdHIgOiBudWxsOyB9LFxuICAgICAgICBcImFycmF5XCI6ICAgZnVuY3Rpb24oc3RyKSB7IHJldHVybiBKU09OLnBhcnNlKHN0cik7IH0sXG4gICAgICAgIFwib2JqZWN0XCI6ICBmdW5jdGlvbihzdHIpIHsgcmV0dXJuIEpTT04ucGFyc2Uoc3RyKTsgfSxcbiAgICAgICAgXCJhdXRvXCI6ICAgIGZ1bmN0aW9uKHN0cikgeyByZXR1cm4gJC5zZXJpYWxpemVKU09OLnBhcnNlVmFsdWUoc3RyLCBudWxsLCBudWxsLCB7cGFyc2VOdW1iZXJzOiB0cnVlLCBwYXJzZUJvb2xlYW5zOiB0cnVlLCBwYXJzZU51bGxzOiB0cnVlfSk7IH0sIC8vIHRyeSBhZ2FpbiB3aXRoIHNvbWV0aGluZyBsaWtlIFwicGFyc2VBbGxcIlxuICAgICAgICBcInNraXBcIjogICAgbnVsbCAvLyBza2lwIGlzIGEgc3BlY2lhbCB0eXBlIHRoYXQgbWFrZXMgaXQgZWFzeSB0byBpZ25vcmUgZWxlbWVudHNcbiAgICAgIH0sXG5cbiAgICAgIHVzZUludEtleXNBc0FycmF5SW5kZXg6IGZhbHNlIC8vIG5hbWU9XCJmb29bMl1cIiB2YWx1ZT1cInZcIiA9PiB7Zm9vOiBbbnVsbCwgbnVsbCwgXCJ2XCJdfSwgaW5zdGVhZCBvZiB7Zm9vOiBbXCIyXCI6IFwidlwiXX1cbiAgICB9LFxuXG4gICAgLy8gTWVyZ2Ugb3B0aW9uIGRlZmF1bHRzIGludG8gdGhlIG9wdGlvbnNcbiAgICBzZXR1cE9wdHM6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgIHZhciBvcHQsIHZhbGlkT3B0cywgZGVmYXVsdE9wdGlvbnMsIG9wdFdpdGhEZWZhdWx0LCBwYXJzZUFsbCwgZjtcbiAgICAgIGYgPSAkLnNlcmlhbGl6ZUpTT047XG5cbiAgICAgIGlmIChvcHRpb25zID09IG51bGwpIHsgb3B0aW9ucyA9IHt9OyB9ICAgLy8gb3B0aW9ucyB8fD0ge31cbiAgICAgIGRlZmF1bHRPcHRpb25zID0gZi5kZWZhdWx0T3B0aW9ucyB8fCB7fTsgLy8gZGVmYXVsdE9wdGlvbnNcblxuICAgICAgLy8gTWFrZSBzdXJlIHRoYXQgdGhlIHVzZXIgZGlkbid0IG1pc3NwZWxsIGFuIG9wdGlvblxuICAgICAgdmFsaWRPcHRzID0gWydjaGVja2JveFVuY2hlY2tlZFZhbHVlJywgJ3BhcnNlTnVtYmVycycsICdwYXJzZUJvb2xlYW5zJywgJ3BhcnNlTnVsbHMnLCAncGFyc2VBbGwnLCAncGFyc2VXaXRoRnVuY3Rpb24nLCAnc2tpcEZhbHN5VmFsdWVzRm9yVHlwZXMnLCAnc2tpcEZhbHN5VmFsdWVzRm9yRmllbGRzJywgJ2N1c3RvbVR5cGVzJywgJ2RlZmF1bHRUeXBlcycsICd1c2VJbnRLZXlzQXNBcnJheUluZGV4J107IC8vIHJlLWRlZmluZSBiZWNhdXNlIHRoZSB1c2VyIG1heSBvdmVycmlkZSB0aGUgZGVmYXVsdE9wdGlvbnNcbiAgICAgIGZvciAob3B0IGluIG9wdGlvbnMpIHtcbiAgICAgICAgaWYgKHZhbGlkT3B0cy5pbmRleE9mKG9wdCkgPT09IC0xKSB7XG4gICAgICAgICAgdGhyb3cgbmV3ICBFcnJvcihcInNlcmlhbGl6ZUpTT04gRVJST1I6IGludmFsaWQgb3B0aW9uICdcIiArIG9wdCArIFwiJy4gUGxlYXNlIHVzZSBvbmUgb2YgXCIgKyB2YWxpZE9wdHMuam9pbignLCAnKSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gSGVscGVyIHRvIGdldCB0aGUgZGVmYXVsdCB2YWx1ZSBmb3IgdGhpcyBvcHRpb24gaWYgbm9uZSBpcyBzcGVjaWZpZWQgYnkgdGhlIHVzZXJcbiAgICAgIG9wdFdpdGhEZWZhdWx0ID0gZnVuY3Rpb24oa2V5KSB7IHJldHVybiAob3B0aW9uc1trZXldICE9PSBmYWxzZSkgJiYgKG9wdGlvbnNba2V5XSAhPT0gJycpICYmIChvcHRpb25zW2tleV0gfHwgZGVmYXVsdE9wdGlvbnNba2V5XSk7IH07XG5cbiAgICAgIC8vIFJldHVybiBjb21wdXRlZCBvcHRpb25zIChvcHRzIHRvIGJlIHVzZWQgaW4gdGhlIHJlc3Qgb2YgdGhlIHNjcmlwdClcbiAgICAgIHBhcnNlQWxsID0gb3B0V2l0aERlZmF1bHQoJ3BhcnNlQWxsJyk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBjaGVja2JveFVuY2hlY2tlZFZhbHVlOiAgICBvcHRXaXRoRGVmYXVsdCgnY2hlY2tib3hVbmNoZWNrZWRWYWx1ZScpLFxuXG4gICAgICAgIHBhcnNlTnVtYmVyczogIHBhcnNlQWxsIHx8IG9wdFdpdGhEZWZhdWx0KCdwYXJzZU51bWJlcnMnKSxcbiAgICAgICAgcGFyc2VCb29sZWFuczogcGFyc2VBbGwgfHwgb3B0V2l0aERlZmF1bHQoJ3BhcnNlQm9vbGVhbnMnKSxcbiAgICAgICAgcGFyc2VOdWxsczogICAgcGFyc2VBbGwgfHwgb3B0V2l0aERlZmF1bHQoJ3BhcnNlTnVsbHMnKSxcbiAgICAgICAgcGFyc2VXaXRoRnVuY3Rpb246ICAgICAgICAgb3B0V2l0aERlZmF1bHQoJ3BhcnNlV2l0aEZ1bmN0aW9uJyksXG5cbiAgICAgICAgc2tpcEZhbHN5VmFsdWVzRm9yVHlwZXM6ICAgb3B0V2l0aERlZmF1bHQoJ3NraXBGYWxzeVZhbHVlc0ZvclR5cGVzJyksXG4gICAgICAgIHNraXBGYWxzeVZhbHVlc0ZvckZpZWxkczogIG9wdFdpdGhEZWZhdWx0KCdza2lwRmFsc3lWYWx1ZXNGb3JGaWVsZHMnKSxcbiAgICAgICAgdHlwZUZ1bmN0aW9uczogJC5leHRlbmQoe30sIG9wdFdpdGhEZWZhdWx0KCdkZWZhdWx0VHlwZXMnKSwgb3B0V2l0aERlZmF1bHQoJ2N1c3RvbVR5cGVzJykpLFxuXG4gICAgICAgIHVzZUludEtleXNBc0FycmF5SW5kZXg6IG9wdFdpdGhEZWZhdWx0KCd1c2VJbnRLZXlzQXNBcnJheUluZGV4JylcbiAgICAgIH07XG4gICAgfSxcblxuICAgIC8vIEdpdmVuIGEgc3RyaW5nLCBhcHBseSB0aGUgdHlwZSBvciB0aGUgcmVsZXZhbnQgXCJwYXJzZVwiIG9wdGlvbnMsIHRvIHJldHVybiB0aGUgcGFyc2VkIHZhbHVlXG4gICAgcGFyc2VWYWx1ZTogZnVuY3Rpb24odmFsU3RyLCBpbnB1dE5hbWUsIHR5cGUsIG9wdHMpIHtcbiAgICAgIHZhciBmLCBwYXJzZWRWYWw7XG4gICAgICBmID0gJC5zZXJpYWxpemVKU09OO1xuICAgICAgcGFyc2VkVmFsID0gdmFsU3RyOyAvLyBpZiBubyBwYXJzaW5nIGlzIG5lZWRlZCwgdGhlIHJldHVybmVkIHZhbHVlIHdpbGwgYmUgdGhlIHNhbWVcblxuICAgICAgaWYgKG9wdHMudHlwZUZ1bmN0aW9ucyAmJiB0eXBlICYmIG9wdHMudHlwZUZ1bmN0aW9uc1t0eXBlXSkgeyAvLyB1c2UgYSB0eXBlIGlmIGF2YWlsYWJsZVxuICAgICAgICBwYXJzZWRWYWwgPSBvcHRzLnR5cGVGdW5jdGlvbnNbdHlwZV0odmFsU3RyKTtcbiAgICAgIH0gZWxzZSBpZiAob3B0cy5wYXJzZU51bWJlcnMgICYmIGYuaXNOdW1lcmljKHZhbFN0cikpIHsgLy8gYXV0bzogbnVtYmVyXG4gICAgICAgIHBhcnNlZFZhbCA9IE51bWJlcih2YWxTdHIpO1xuICAgICAgfSBlbHNlIGlmIChvcHRzLnBhcnNlQm9vbGVhbnMgJiYgKHZhbFN0ciA9PT0gXCJ0cnVlXCIgfHwgdmFsU3RyID09PSBcImZhbHNlXCIpKSB7IC8vIGF1dG86IGJvb2xlYW5cbiAgICAgICAgcGFyc2VkVmFsID0gKHZhbFN0ciA9PT0gXCJ0cnVlXCIpO1xuICAgICAgfSBlbHNlIGlmIChvcHRzLnBhcnNlTnVsbHMgICAgJiYgdmFsU3RyID09IFwibnVsbFwiKSB7IC8vIGF1dG86IG51bGxcbiAgICAgICAgcGFyc2VkVmFsID0gbnVsbDtcbiAgICAgIH1cbiAgICAgIGlmIChvcHRzLnBhcnNlV2l0aEZ1bmN0aW9uICYmICF0eXBlKSB7IC8vIGN1c3RvbSBwYXJzZSBmdW5jdGlvbiAoYXBwbHkgYWZ0ZXIgcHJldmlvdXMgcGFyc2luZyBvcHRpb25zLCBidXQgbm90IGlmIHRoZXJlJ3MgYSBzcGVjaWZpYyB0eXBlKVxuICAgICAgICBwYXJzZWRWYWwgPSBvcHRzLnBhcnNlV2l0aEZ1bmN0aW9uKHBhcnNlZFZhbCwgaW5wdXROYW1lKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHBhcnNlZFZhbDtcbiAgICB9LFxuXG4gICAgaXNPYmplY3Q6ICAgICAgICAgIGZ1bmN0aW9uKG9iaikgeyByZXR1cm4gb2JqID09PSBPYmplY3Qob2JqKTsgfSwgLy8gaXMgaXQgYW4gT2JqZWN0P1xuICAgIGlzVW5kZWZpbmVkOiAgICAgICBmdW5jdGlvbihvYmopIHsgcmV0dXJuIG9iaiA9PT0gdm9pZCAwOyB9LCAvLyBzYWZlIGNoZWNrIGZvciB1bmRlZmluZWQgdmFsdWVzXG4gICAgaXNWYWxpZEFycmF5SW5kZXg6IGZ1bmN0aW9uKHZhbCkgeyByZXR1cm4gL15bMC05XSskLy50ZXN0KFN0cmluZyh2YWwpKTsgfSwgLy8gMSwyLDMsNCAuLi4gYXJlIHZhbGlkIGFycmF5IGluZGV4ZXNcbiAgICBpc051bWVyaWM6ICAgICAgICAgZnVuY3Rpb24ob2JqKSB7IHJldHVybiBvYmogLSBwYXJzZUZsb2F0KG9iaikgPj0gMDsgfSwgLy8gdGFrZW4gZnJvbSBqUXVlcnkuaXNOdW1lcmljIGltcGxlbWVudGF0aW9uLiBOb3QgdXNpbmcgalF1ZXJ5LmlzTnVtZXJpYyB0byBzdXBwb3J0IG9sZCBqUXVlcnkgYW5kIFplcHRvIHZlcnNpb25zXG5cbiAgICBvcHRpb25LZXlzOiBmdW5jdGlvbihvYmopIHsgaWYgKE9iamVjdC5rZXlzKSB7IHJldHVybiBPYmplY3Qua2V5cyhvYmopOyB9IGVsc2UgeyB2YXIga2V5LCBrZXlzID0gW107IGZvcihrZXkgaW4gb2JqKXsga2V5cy5wdXNoKGtleSk7IH0gcmV0dXJuIGtleXM7fSB9LCAvLyBwb2x5ZmlsbCBPYmplY3Qua2V5cyB0byBnZXQgb3B0aW9uIGtleXMgaW4gSUU8OVxuXG5cbiAgICAvLyBGaWxsIHRoZSBmb3JtQXNBcnJheSBvYmplY3Qgd2l0aCB2YWx1ZXMgZm9yIHRoZSB1bmNoZWNrZWQgY2hlY2tib3ggaW5wdXRzLFxuICAgIC8vIHVzaW5nIHRoZSBzYW1lIGZvcm1hdCBhcyB0aGUganF1ZXJ5LnNlcmlhbGl6ZUFycmF5IGZ1bmN0aW9uLlxuICAgIC8vIFRoZSB2YWx1ZSBvZiB0aGUgdW5jaGVja2VkIHZhbHVlcyBpcyBkZXRlcm1pbmVkIGZyb20gdGhlIG9wdHMuY2hlY2tib3hVbmNoZWNrZWRWYWx1ZVxuICAgIC8vIGFuZC9vciB0aGUgZGF0YS11bmNoZWNrZWQtdmFsdWUgYXR0cmlidXRlIG9mIHRoZSBpbnB1dHMuXG4gICAgcmVhZENoZWNrYm94VW5jaGVja2VkVmFsdWVzOiBmdW5jdGlvbiAoZm9ybUFzQXJyYXksIG9wdHMsICRmb3JtKSB7XG4gICAgICB2YXIgc2VsZWN0b3IsICR1bmNoZWNrZWRDaGVja2JveGVzLCAkZWwsIHVuY2hlY2tlZFZhbHVlLCBmLCBuYW1lO1xuICAgICAgaWYgKG9wdHMgPT0gbnVsbCkgeyBvcHRzID0ge307IH1cbiAgICAgIGYgPSAkLnNlcmlhbGl6ZUpTT047XG5cbiAgICAgIHNlbGVjdG9yID0gJ2lucHV0W3R5cGU9Y2hlY2tib3hdW25hbWVdOm5vdCg6Y2hlY2tlZCk6bm90KFtkaXNhYmxlZF0pJztcbiAgICAgICR1bmNoZWNrZWRDaGVja2JveGVzID0gJGZvcm0uZmluZChzZWxlY3RvcikuYWRkKCRmb3JtLmZpbHRlcihzZWxlY3RvcikpO1xuICAgICAgJHVuY2hlY2tlZENoZWNrYm94ZXMuZWFjaChmdW5jdGlvbiAoaSwgZWwpIHtcbiAgICAgICAgLy8gQ2hlY2sgZGF0YSBhdHRyIGZpcnN0LCB0aGVuIHRoZSBvcHRpb25cbiAgICAgICAgJGVsID0gJChlbCk7XG4gICAgICAgIHVuY2hlY2tlZFZhbHVlID0gJGVsLmF0dHIoJ2RhdGEtdW5jaGVja2VkLXZhbHVlJyk7XG4gICAgICAgIGlmICh1bmNoZWNrZWRWYWx1ZSA9PSBudWxsKSB7XG4gICAgICAgICAgdW5jaGVja2VkVmFsdWUgPSBvcHRzLmNoZWNrYm94VW5jaGVja2VkVmFsdWU7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBJZiB0aGVyZSdzIGFuIHVuY2hlY2tlZFZhbHVlLCBwdXNoIGl0IGludG8gdGhlIHNlcmlhbGl6ZWQgZm9ybUFzQXJyYXlcbiAgICAgICAgaWYgKHVuY2hlY2tlZFZhbHVlICE9IG51bGwpIHtcbiAgICAgICAgICBpZiAoZWwubmFtZSAmJiBlbC5uYW1lLmluZGV4T2YoXCJbXVtcIikgIT09IC0xKSB7IC8vIGlkZW50aWZ5IGEgbm9uLXN1cHBvcnRlZFxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwic2VyaWFsaXplSlNPTiBFUlJPUjogY2hlY2tib3ggdW5jaGVja2VkIHZhbHVlcyBhcmUgbm90IHN1cHBvcnRlZCBvbiBuZXN0ZWQgYXJyYXlzIG9mIG9iamVjdHMgbGlrZSAnXCIrZWwubmFtZStcIicuIFNlZSBodHRwczovL2dpdGh1Yi5jb20vbWFyaW9penF1aWVyZG8vanF1ZXJ5LnNlcmlhbGl6ZUpTT04vaXNzdWVzLzY3XCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBmb3JtQXNBcnJheS5wdXNoKHtuYW1lOiBlbC5uYW1lLCB2YWx1ZTogdW5jaGVja2VkVmFsdWV9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8vIFJldHVybnMgYW5kIG9iamVjdCB3aXRoIHByb3BlcnRpZXMge25hbWVfd2l0aG91dF90eXBlLCB0eXBlfSBmcm9tIGEgZ2l2ZW4gbmFtZS5cbiAgICAvLyBUaGUgdHlwZSBpcyBudWxsIGlmIG5vbmUgc3BlY2lmaWVkLiBFeGFtcGxlOlxuICAgIC8vICAgXCJmb29cIiAgICAgICAgICAgPT4gIHtuYW1lV2l0aE5vVHlwZTogXCJmb29cIiwgICAgICB0eXBlOiAgbnVsbH1cbiAgICAvLyAgIFwiZm9vOmJvb2xlYW5cIiAgID0+ICB7bmFtZVdpdGhOb1R5cGU6IFwiZm9vXCIsICAgICAgdHlwZTogXCJib29sZWFuXCJ9XG4gICAgLy8gICBcImZvb1tiYXJdOm51bGxcIiA9PiAge25hbWVXaXRoTm9UeXBlOiBcImZvb1tiYXJdXCIsIHR5cGU6IFwibnVsbFwifVxuICAgIGV4dHJhY3RUeXBlQW5kTmFtZVdpdGhOb1R5cGU6IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICAgIHZhciBtYXRjaDtcbiAgICAgIGlmIChtYXRjaCA9IG5hbWUubWF0Y2goLyguKik6KFteOl0rKSQvKSkge1xuICAgICAgICByZXR1cm4ge25hbWVXaXRoTm9UeXBlOiBtYXRjaFsxXSwgdHlwZTogbWF0Y2hbMl19O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHtuYW1lV2l0aE5vVHlwZTogbmFtZSwgdHlwZTogbnVsbH07XG4gICAgICB9XG4gICAgfSxcblxuXG4gICAgLy8gQ2hlY2sgaWYgdGhpcyBpbnB1dCBzaG91bGQgYmUgc2tpcHBlZCB3aGVuIGl0IGhhcyBhIGZhbHN5IHZhbHVlLFxuICAgIC8vIGRlcGVuZGluZyBvbiB0aGUgb3B0aW9ucyB0byBza2lwIHZhbHVlcyBieSBuYW1lIG9yIHR5cGUsIGFuZCB0aGUgZGF0YS1za2lwLWZhbHN5IGF0dHJpYnV0ZS5cbiAgICBzaG91bGRTa2lwRmFsc3k6IGZ1bmN0aW9uKCRmb3JtLCBuYW1lLCBuYW1lV2l0aE5vVHlwZSwgdHlwZSwgb3B0cykge1xuICAgICAgdmFyIGYgPSAkLnNlcmlhbGl6ZUpTT047XG4gICAgICBcbiAgICAgIHZhciBza2lwRnJvbURhdGFBdHRyID0gZi5hdHRyRnJvbUlucHV0V2l0aE5hbWUoJGZvcm0sIG5hbWUsICdkYXRhLXNraXAtZmFsc3knKTtcbiAgICAgIGlmIChza2lwRnJvbURhdGFBdHRyICE9IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHNraXBGcm9tRGF0YUF0dHIgIT09ICdmYWxzZSc7IC8vIGFueSB2YWx1ZSBpcyB0cnVlLCBleGNlcHQgaWYgZXhwbGljaXRseSB1c2luZyAnZmFsc2UnIFxuICAgICAgfVxuXG4gICAgICB2YXIgb3B0Rm9yRmllbGRzID0gb3B0cy5za2lwRmFsc3lWYWx1ZXNGb3JGaWVsZHM7XG4gICAgICBpZiAob3B0Rm9yRmllbGRzICYmIChvcHRGb3JGaWVsZHMuaW5kZXhPZihuYW1lV2l0aE5vVHlwZSkgIT09IC0xIHx8IG9wdEZvckZpZWxkcy5pbmRleE9mKG5hbWUpICE9PSAtMSkpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICBcbiAgICAgIHZhciBvcHRGb3JUeXBlcyA9IG9wdHMuc2tpcEZhbHN5VmFsdWVzRm9yVHlwZXM7XG4gICAgICBpZiAodHlwZSA9PSBudWxsKSB0eXBlID0gJ3N0cmluZyc7IC8vIGFzc3VtZSBmaWVsZHMgd2l0aCBubyB0eXBlIGFyZSB0YXJnZXRlZCBhcyBzdHJpbmdcbiAgICAgIGlmIChvcHRGb3JUeXBlcyAmJiBvcHRGb3JUeXBlcy5pbmRleE9mKHR5cGUpICE9PSAtMSkge1xuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcblxuICAgIC8vIEZpbmRzIHRoZSBmaXJzdCBpbnB1dCBpbiAkZm9ybSB3aXRoIHRoaXMgbmFtZSwgYW5kIGdldCB0aGUgZ2l2ZW4gYXR0ciBmcm9tIGl0LlxuICAgIC8vIFJldHVybnMgdW5kZWZpbmVkIGlmIG5vIGlucHV0IG9yIG5vIGF0dHJpYnV0ZSB3YXMgZm91bmQuXG4gICAgYXR0ckZyb21JbnB1dFdpdGhOYW1lOiBmdW5jdGlvbigkZm9ybSwgbmFtZSwgYXR0ck5hbWUpIHtcbiAgICAgIHZhciBlc2NhcGVkTmFtZSwgc2VsZWN0b3IsICRpbnB1dCwgYXR0clZhbHVlO1xuICAgICAgZXNjYXBlZE5hbWUgPSBuYW1lLnJlcGxhY2UoLyg6fFxcLnxcXFt8XFxdfFxccykvZywnXFxcXCQxJyk7IC8vIGV2ZXJ5IG5vbi1zdGFuZGFyZCBjaGFyYWN0ZXIgbmVlZCB0byBiZSBlc2NhcGVkIGJ5IFxcXFxcbiAgICAgIHNlbGVjdG9yID0gJ1tuYW1lPVwiJyArIGVzY2FwZWROYW1lICsgJ1wiXSc7XG4gICAgICAkaW5wdXQgPSAkZm9ybS5maW5kKHNlbGVjdG9yKS5hZGQoJGZvcm0uZmlsdGVyKHNlbGVjdG9yKSk7IC8vIE5PVEU6IHRoaXMgcmV0dXJucyBvbmx5IHRoZSBmaXJzdCAkaW5wdXQgZWxlbWVudCBpZiBtdWx0aXBsZSBhcmUgbWF0Y2hlZCB3aXRoIHRoZSBzYW1lIG5hbWUgKGkuZS4gYW4gXCJhcnJheVtdXCIpLiBTbywgYXJyYXlzIHdpdGggZGlmZmVyZW50IGVsZW1lbnQgdHlwZXMgc3BlY2lmaWVkIHRocm91Z2ggdGhlIGRhdGEtdmFsdWUtdHlwZSBhdHRyIGlzIG5vdCBzdXBwb3J0ZWQuXG4gICAgICByZXR1cm4gJGlucHV0LmF0dHIoYXR0ck5hbWUpO1xuICAgIH0sXG5cbiAgICAvLyBSYWlzZSBhbiBlcnJvciBpZiB0aGUgdHlwZSBpcyBub3QgcmVjb2duaXplZC5cbiAgICB2YWxpZGF0ZVR5cGU6IGZ1bmN0aW9uKG5hbWUsIHR5cGUsIG9wdHMpIHtcbiAgICAgIHZhciB2YWxpZFR5cGVzLCBmO1xuICAgICAgZiA9ICQuc2VyaWFsaXplSlNPTjtcbiAgICAgIHZhbGlkVHlwZXMgPSBmLm9wdGlvbktleXMob3B0cyA/IG9wdHMudHlwZUZ1bmN0aW9ucyA6IGYuZGVmYXVsdE9wdGlvbnMuZGVmYXVsdFR5cGVzKTtcbiAgICAgIGlmICghdHlwZSB8fCB2YWxpZFR5cGVzLmluZGV4T2YodHlwZSkgIT09IC0xKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwic2VyaWFsaXplSlNPTiBFUlJPUjogSW52YWxpZCB0eXBlIFwiICsgdHlwZSArIFwiIGZvdW5kIGluIGlucHV0IG5hbWUgJ1wiICsgbmFtZSArIFwiJywgcGxlYXNlIHVzZSBvbmUgb2YgXCIgKyB2YWxpZFR5cGVzLmpvaW4oJywgJykpO1xuICAgICAgfVxuICAgIH0sXG5cblxuICAgIC8vIFNwbGl0IHRoZSBpbnB1dCBuYW1lIGluIHByb2dyYW1hdGljYWxseSByZWFkYWJsZSBrZXlzLlxuICAgIC8vIEV4YW1wbGVzOlxuICAgIC8vIFwiZm9vXCIgICAgICAgICAgICAgID0+IFsnZm9vJ11cbiAgICAvLyBcIltmb29dXCIgICAgICAgICAgICA9PiBbJ2ZvbyddXG4gICAgLy8gXCJmb29baW5uXVtiYXJdXCIgICAgPT4gWydmb28nLCAnaW5uJywgJ2JhciddXG4gICAgLy8gXCJmb29baW5uW2Jhcl1dXCIgICAgPT4gWydmb28nLCAnaW5uJywgJ2JhciddXG4gICAgLy8gXCJmb29baW5uXVthcnJdWzBdXCIgPT4gWydmb28nLCAnaW5uJywgJ2FycicsICcwJ11cbiAgICAvLyBcImFycltdW3ZhbF1cIiAgICAgICA9PiBbJ2FycicsICcnLCAndmFsJ11cbiAgICBzcGxpdElucHV0TmFtZUludG9LZXlzQXJyYXk6IGZ1bmN0aW9uKG5hbWVXaXRoTm9UeXBlKSB7XG4gICAgICB2YXIga2V5cywgZjtcbiAgICAgIGYgPSAkLnNlcmlhbGl6ZUpTT047XG4gICAgICBrZXlzID0gbmFtZVdpdGhOb1R5cGUuc3BsaXQoJ1snKTsgLy8gc3BsaXQgc3RyaW5nIGludG8gYXJyYXlcbiAgICAgIGtleXMgPSAkLm1hcChrZXlzLCBmdW5jdGlvbiAoa2V5KSB7IHJldHVybiBrZXkucmVwbGFjZSgvXFxdL2csICcnKTsgfSk7IC8vIHJlbW92ZSBjbG9zaW5nIGJyYWNrZXRzXG4gICAgICBpZiAoa2V5c1swXSA9PT0gJycpIHsga2V5cy5zaGlmdCgpOyB9IC8vIGVuc3VyZSBubyBvcGVuaW5nIGJyYWNrZXQgKFwiW2Zvb11baW5uXVwiIHNob3VsZCBiZSBzYW1lIGFzIFwiZm9vW2lubl1cIilcbiAgICAgIHJldHVybiBrZXlzO1xuICAgIH0sXG5cbiAgICAvLyBTZXQgYSB2YWx1ZSBpbiBhbiBvYmplY3Qgb3IgYXJyYXksIHVzaW5nIG11bHRpcGxlIGtleXMgdG8gc2V0IGluIGEgbmVzdGVkIG9iamVjdCBvciBhcnJheTpcbiAgICAvL1xuICAgIC8vIGRlZXBTZXQob2JqLCBbJ2ZvbyddLCB2KSAgICAgICAgICAgICAgIC8vIG9ialsnZm9vJ10gPSB2XG4gICAgLy8gZGVlcFNldChvYmosIFsnZm9vJywgJ2lubiddLCB2KSAgICAgICAgLy8gb2JqWydmb28nXVsnaW5uJ10gPSB2IC8vIENyZWF0ZSB0aGUgaW5uZXIgb2JqWydmb28nXSBvYmplY3QsIGlmIG5lZWRlZFxuICAgIC8vIGRlZXBTZXQob2JqLCBbJ2ZvbycsICdpbm4nLCAnMTIzJ10sIHYpIC8vIG9ialsnZm9vJ11bJ2FyciddWycxMjMnXSA9IHYgLy9cbiAgICAvL1xuICAgIC8vIGRlZXBTZXQob2JqLCBbJzAnXSwgdikgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9ialsnMCddID0gdlxuICAgIC8vIGRlZXBTZXQoYXJyLCBbJzAnXSwgdiwge3VzZUludEtleXNBc0FycmF5SW5kZXg6IHRydWV9KSAgIC8vIGFyclswXSA9IHZcbiAgICAvLyBkZWVwU2V0KGFyciwgWycnXSwgdikgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhcnIucHVzaCh2KVxuICAgIC8vIGRlZXBTZXQob2JqLCBbJ2FycicsICcnXSwgdikgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9ialsnYXJyJ10ucHVzaCh2KVxuICAgIC8vXG4gICAgLy8gYXJyID0gW107XG4gICAgLy8gZGVlcFNldChhcnIsIFsnJywgdl0gICAgICAgICAgLy8gYXJyID0+IFt2XVxuICAgIC8vIGRlZXBTZXQoYXJyLCBbJycsICdmb28nXSwgdikgIC8vIGFyciA9PiBbdiwge2Zvbzogdn1dXG4gICAgLy8gZGVlcFNldChhcnIsIFsnJywgJ2JhciddLCB2KSAgLy8gYXJyID0+IFt2LCB7Zm9vOiB2LCBiYXI6IHZ9XVxuICAgIC8vIGRlZXBTZXQoYXJyLCBbJycsICdiYXInXSwgdikgIC8vIGFyciA9PiBbdiwge2ZvbzogdiwgYmFyOiB2fSwge2Jhcjogdn1dXG4gICAgLy9cbiAgICBkZWVwU2V0OiBmdW5jdGlvbiAobywga2V5cywgdmFsdWUsIG9wdHMpIHtcbiAgICAgIHZhciBrZXksIG5leHRLZXksIHRhaWwsIGxhc3RJZHgsIGxhc3RWYWwsIGY7XG4gICAgICBpZiAob3B0cyA9PSBudWxsKSB7IG9wdHMgPSB7fTsgfVxuICAgICAgZiA9ICQuc2VyaWFsaXplSlNPTjtcbiAgICAgIGlmIChmLmlzVW5kZWZpbmVkKG8pKSB7IHRocm93IG5ldyBFcnJvcihcIkFyZ3VtZW50RXJyb3I6IHBhcmFtICdvJyBleHBlY3RlZCB0byBiZSBhbiBvYmplY3Qgb3IgYXJyYXksIGZvdW5kIHVuZGVmaW5lZFwiKTsgfVxuICAgICAgaWYgKCFrZXlzIHx8IGtleXMubGVuZ3RoID09PSAwKSB7IHRocm93IG5ldyBFcnJvcihcIkFyZ3VtZW50RXJyb3I6IHBhcmFtICdrZXlzJyBleHBlY3RlZCB0byBiZSBhbiBhcnJheSB3aXRoIGxlYXN0IG9uZSBlbGVtZW50XCIpOyB9XG5cbiAgICAgIGtleSA9IGtleXNbMF07XG5cbiAgICAgIC8vIE9ubHkgb25lIGtleSwgdGhlbiBpdCdzIG5vdCBhIGRlZXBTZXQsIGp1c3QgYXNzaWduIHRoZSB2YWx1ZS5cbiAgICAgIGlmIChrZXlzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICBpZiAoa2V5ID09PSAnJykge1xuICAgICAgICAgIG8ucHVzaCh2YWx1ZSk7IC8vICcnIGlzIHVzZWQgdG8gcHVzaCB2YWx1ZXMgaW50byB0aGUgYXJyYXkgKGFzc3VtZSBvIGlzIGFuIGFycmF5KVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG9ba2V5XSA9IHZhbHVlOyAvLyBvdGhlciBrZXlzIGNhbiBiZSB1c2VkIGFzIG9iamVjdCBrZXlzIG9yIGFycmF5IGluZGV4ZXNcbiAgICAgICAgfVxuXG4gICAgICAvLyBXaXRoIG1vcmUga2V5cyBpcyBhIGRlZXBTZXQuIEFwcGx5IHJlY3Vyc2l2ZWx5LlxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbmV4dEtleSA9IGtleXNbMV07XG5cbiAgICAgICAgLy8gJycgaXMgdXNlZCB0byBwdXNoIHZhbHVlcyBpbnRvIHRoZSBhcnJheSxcbiAgICAgICAgLy8gd2l0aCBuZXh0S2V5LCBzZXQgdGhlIHZhbHVlIGludG8gdGhlIHNhbWUgb2JqZWN0LCBpbiBvYmplY3RbbmV4dEtleV0uXG4gICAgICAgIC8vIENvdmVycyB0aGUgY2FzZSBvZiBbJycsICdmb28nXSBhbmQgWycnLCAndmFyJ10gdG8gcHVzaCB0aGUgb2JqZWN0IHtmb28sIHZhcn0sIGFuZCB0aGUgY2FzZSBvZiBuZXN0ZWQgYXJyYXlzLlxuICAgICAgICBpZiAoa2V5ID09PSAnJykge1xuICAgICAgICAgIGxhc3RJZHggPSBvLmxlbmd0aCAtIDE7IC8vIGFzdW1lIG8gaXMgYXJyYXlcbiAgICAgICAgICBsYXN0VmFsID0gb1tsYXN0SWR4XTtcbiAgICAgICAgICBpZiAoZi5pc09iamVjdChsYXN0VmFsKSAmJiAoZi5pc1VuZGVmaW5lZChsYXN0VmFsW25leHRLZXldKSB8fCBrZXlzLmxlbmd0aCA+IDIpKSB7IC8vIGlmIG5leHRLZXkgaXMgbm90IHByZXNlbnQgaW4gdGhlIGxhc3Qgb2JqZWN0IGVsZW1lbnQsIG9yIHRoZXJlIGFyZSBtb3JlIGtleXMgdG8gZGVlcCBzZXRcbiAgICAgICAgICAgIGtleSA9IGxhc3RJZHg7IC8vIHRoZW4gc2V0IHRoZSBuZXcgdmFsdWUgaW4gdGhlIHNhbWUgb2JqZWN0IGVsZW1lbnRcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAga2V5ID0gbGFzdElkeCArIDE7IC8vIG90aGVyd2lzZSwgcG9pbnQgdG8gc2V0IHRoZSBuZXh0IGluZGV4IGluIHRoZSBhcnJheVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vICcnIGlzIHVzZWQgdG8gcHVzaCB2YWx1ZXMgaW50byB0aGUgYXJyYXkgXCJhcnJheVtdXCJcbiAgICAgICAgaWYgKG5leHRLZXkgPT09ICcnKSB7XG4gICAgICAgICAgaWYgKGYuaXNVbmRlZmluZWQob1trZXldKSB8fCAhJC5pc0FycmF5KG9ba2V5XSkpIHtcbiAgICAgICAgICAgIG9ba2V5XSA9IFtdOyAvLyBkZWZpbmUgKG9yIG92ZXJyaWRlKSBhcyBhcnJheSB0byBwdXNoIHZhbHVlc1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAob3B0cy51c2VJbnRLZXlzQXNBcnJheUluZGV4ICYmIGYuaXNWYWxpZEFycmF5SW5kZXgobmV4dEtleSkpIHsgLy8gaWYgMSwgMiwgMyAuLi4gdGhlbiB1c2UgYW4gYXJyYXksIHdoZXJlIG5leHRLZXkgaXMgdGhlIGluZGV4XG4gICAgICAgICAgICBpZiAoZi5pc1VuZGVmaW5lZChvW2tleV0pIHx8ICEkLmlzQXJyYXkob1trZXldKSkge1xuICAgICAgICAgICAgICBvW2tleV0gPSBbXTsgLy8gZGVmaW5lIChvciBvdmVycmlkZSkgYXMgYXJyYXksIHRvIGluc2VydCB2YWx1ZXMgdXNpbmcgaW50IGtleXMgYXMgYXJyYXkgaW5kZXhlc1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7IC8vIGZvciBhbnl0aGluZyBlbHNlLCB1c2UgYW4gb2JqZWN0LCB3aGVyZSBuZXh0S2V5IGlzIGdvaW5nIHRvIGJlIHRoZSBhdHRyaWJ1dGUgbmFtZVxuICAgICAgICAgICAgaWYgKGYuaXNVbmRlZmluZWQob1trZXldKSB8fCAhZi5pc09iamVjdChvW2tleV0pKSB7XG4gICAgICAgICAgICAgIG9ba2V5XSA9IHt9OyAvLyBkZWZpbmUgKG9yIG92ZXJyaWRlKSBhcyBvYmplY3QsIHRvIHNldCBuZXN0ZWQgcHJvcGVydGllc1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFJlY3Vyc2l2ZWx5IHNldCB0aGUgaW5uZXIgb2JqZWN0XG4gICAgICAgIHRhaWwgPSBrZXlzLnNsaWNlKDEpO1xuICAgICAgICBmLmRlZXBTZXQob1trZXldLCB0YWlsLCB2YWx1ZSwgb3B0cyk7XG4gICAgICB9XG4gICAgfVxuXG4gIH07XG5cbn0pKTtcbiJdfQ==
